
# Docker Compose ê¸°ì´ˆ

## ğŸ¼ Docker Composeë€?

### ğŸ» ì˜¤ì¼€ìŠ¤íŠ¸ë¼ ë¹„ìœ 
```
ğŸ¼ Docker Compose = ì§€íœ˜ì
ğŸ» ê°œë³„ ì»¨í…Œì´ë„ˆ = ê°ê°ì˜ ì•…ê¸° ì—°ì£¼ì
ğŸµ docker-compose.yml = ì•…ë³´
ğŸª ì „ì²´ ì• í”Œë¦¬ì¼€ì´ì…˜ = ì™„ì„±ëœ êµí–¥ê³¡

ë¬¸ì œ: ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆë¥¼ í•˜ë‚˜ì”© ì‹¤í–‰í•˜ê¸° ë³µì¡! ğŸ˜«
í•´ê²°: Composeê°€ í•œ ë²ˆì— ëª¨ë“  ì»¨í…Œì´ë„ˆë¥¼ ì¡°í™”ë¡­ê²Œ! ğŸ¼
```

### ğŸ—ï¸ ê±´ì¶• í˜„ì¥ ë¹„ìœ 
```
ğŸ—ï¸ Docker Compose = ê±´ì¶• ê°ë…
ğŸ§± ê°œë³„ ì»¨í…Œì´ë„ˆ = ê° ê³µì¢… (ì „ê¸°, ë°°ê´€, ë‚´ì¥)
ğŸ“‹ docker-compose.yml = ì‹œê³µ ê³„íšì„œ
ğŸ¢ ì™„ì„±ëœ ê±´ë¬¼ = ìš´ì˜ ì¤‘ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜

í•œ ëª…ë ¹ì–´ë¡œ ëª¨ë“  ì‘ì—…ìê°€ ë™ì‹œì— ì‘ì—… ì‹œì‘!
```

## ì™œ Docker Composeê°€ í•„ìš”í•œê°€?

### ğŸ˜° ê¸°ì¡´ ë°©ì‹ì˜ ë¬¸ì œì 
```bash
# ğŸ˜« ê°œë³„ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ì˜ ê³ í†µ
# 1. ë„¤íŠ¸ì›Œí¬ ìƒì„±
docker network create myapp-network

# 2. ë°ì´í„°ë² ì´ìŠ¤ ì‹¤í–‰
docker run -d \
  --name database \
  --network myapp-network \
  -e MYSQL_ROOT_PASSWORD=password \
  -e MYSQL_DATABASE=myapp \
  -v mysql-data:/var/lib/mysql \
  mysql:8.0

# 3. Redis ì‹¤í–‰  
docker run -d \
  --name redis \
  --network myapp-network \
  redis:alpine

# 4. ë°±ì—”ë“œ API ì‹¤í–‰
docker run -d \
  --name api \
  --network myapp-network \
  -e DB_HOST=database \
  -e REDIS_HOST=redis \
  my-api:latest

# 5. í”„ë¡ íŠ¸ì—”ë“œ ì‹¤í–‰
docker run -d \
  --name frontend \
  --network myapp-network \
  -p 80:80 \
  -e API_URL=http://api:3000 \
  my-frontend:latest

# ğŸ˜± ëª…ë ¹ì–´ë§Œ 10ì¤„ ë„˜ê²Œ... ì‹¤ìˆ˜í•˜ê¸° ì‰½ê³  ê´€ë¦¬ ë³µì¡!
```

### âœ… Docker Composeì˜ í•´ê²°ì±…
```yaml
# ğŸ˜Š docker-compose.yml í•˜ë‚˜ë¡œ í•´ê²°!
version: '3.8'

services:
  database:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: password
      MYSQL_DATABASE: myapp
    volumes:
      - mysql-data:/var/lib/mysql

  redis:
    image: redis:alpine

  api:
    image: my-api:latest
    environment:
      DB_HOST: database
      REDIS_HOST: redis
    depends_on:
      - database
      - redis

  frontend:
    image: my-frontend:latest
    ports:
      - "80:80"
    environment:
      API_URL: http://api:3000
    depends_on:
      - api

volumes:
  mysql-data:

# ğŸš€ ë‹¨ í•œ ì¤„ë¡œ ëª¨ë“  ì„œë¹„ìŠ¤ ì‹¤í–‰!
# docker-compose up -d
```

## Docker Compose ì„¤ì¹˜

### ğŸ’» ì„¤ì¹˜ ë°©ë²•
```bash
# Docker Desktop ì‚¬ìš©ì (Windows/Mac)
# Docker Desktopì— ì´ë¯¸ í¬í•¨ë˜ì–´ ìˆìŒ!

# Linux ì‚¬ìš©ì
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# ì„¤ì¹˜ í™•ì¸
docker-compose --version
```

## ê¸°ë³¸ ë¬¸ë²•ê³¼ êµ¬ì¡°

### ğŸ“„ YAML íŒŒì¼ êµ¬ì¡°
```yaml
# docker-compose.yml ê¸°ë³¸ êµ¬ì¡°
version: '3.8'  # Compose íŒŒì¼ ë²„ì „

services:       # ì»¨í…Œì´ë„ˆ ì •ì˜
  service1:
    # ì„œë¹„ìŠ¤ ì„¤ì •
  service2:
    # ì„œë¹„ìŠ¤ ì„¤ì •

volumes:        # ë³¼ë¥¨ ì •ì˜ (ì„ íƒì‚¬í•­)
  volume1:
  volume2:

networks:       # ë„¤íŠ¸ì›Œí¬ ì •ì˜ (ì„ íƒì‚¬í•­)
  network1:
  network2:
```

### ğŸ¯ í•µì‹¬ ì„œë¹„ìŠ¤ ì„¤ì •
```yaml
services:
  web:
    # ì´ë¯¸ì§€ ì§€ì •
    image: nginx:alpine
    
    # ë˜ëŠ” Dockerfileë¡œ ë¹Œë“œ
    build: .
    
    # í¬íŠ¸ ë§¤í•‘
    ports:
      - "80:80"
      - "443:443"
    
    # í™˜ê²½ ë³€ìˆ˜
    environment:
      - NODE_ENV=production
      - API_URL=http://api:3000
    
    # ë³¼ë¥¨ ë§ˆìš´íŠ¸
    volumes:
      - ./html:/usr/share/nginx/html
      - nginx-logs:/var/log/nginx
    
    # ì˜ì¡´ì„±
    depends_on:
      - api
      - database
    
    # ì¬ì‹œì‘ ì •ì±…
    restart: unless-stopped
```

## ê¸°ë³¸ ëª…ë ¹ì–´

### ğŸš€ ì„œë¹„ìŠ¤ ì‹œì‘ê³¼ ì¤‘ì§€
```bash
# ëª¨ë“  ì„œë¹„ìŠ¤ ì‹œì‘ (ë°±ê·¸ë¼ìš´ë“œ)
docker-compose up -d

# í¬ê·¸ë¼ìš´ë“œë¡œ ì‹œì‘ (ë¡œê·¸ í™•ì¸ ê°€ëŠ¥)
docker-compose up

# íŠ¹ì • ì„œë¹„ìŠ¤ë§Œ ì‹œì‘
docker-compose up -d web database

# ì„œë¹„ìŠ¤ ì¤‘ì§€
docker-compose stop

# ì„œë¹„ìŠ¤ ì¤‘ì§€ ë° ì»¨í…Œì´ë„ˆ ì‚­ì œ
docker-compose down

# ë³¼ë¥¨ê¹Œì§€ ì‚­ì œ
docker-compose down -v
```

### ğŸ” ìƒíƒœ í™•ì¸
```bash
# ì‹¤í–‰ ì¤‘ì¸ ì„œë¹„ìŠ¤ í™•ì¸
docker-compose ps

# ì„œë¹„ìŠ¤ ë¡œê·¸ í™•ì¸
docker-compose logs

# íŠ¹ì • ì„œë¹„ìŠ¤ ë¡œê·¸ë§Œ
docker-compose logs web

# ì‹¤ì‹œê°„ ë¡œê·¸ ìŠ¤íŠ¸ë¦¬ë°
docker-compose logs -f api
```

### ğŸ”§ ì„œë¹„ìŠ¤ ê´€ë¦¬
```bash
# ì„œë¹„ìŠ¤ ì¬ì‹œì‘
docker-compose restart web

# ì„œë¹„ìŠ¤ ìŠ¤ì¼€ì¼ë§
docker-compose up -d --scale web=3

# ì„œë¹„ìŠ¤ ë‚´ë¶€ ì ‘ê·¼
docker-compose exec web bash
docker-compose exec database mysql -u root -p

# ìƒˆ ì»¨í…Œì´ë„ˆì—ì„œ ëª…ë ¹ì–´ ì‹¤í–‰
docker-compose run --rm web curl http://api:3000
```

## ì‹¤ì „ ì˜ˆì‹œ

### ğŸŒ LAMP ìŠ¤íƒ (Linux + Apache + MySQL + PHP)
```yaml
# docker-compose.yml
version: '3.8'

services:
  # ì›¹ ì„œë²„ (Apache + PHP)
  web:
    image: php:8.0-apache
    ports:
      - "80:80"
    volumes:
      - ./src:/var/www/html
    depends_on:
      - database
    environment:
      - DB_HOST=database
      - DB_NAME=myapp
      - DB_USER=root
      - DB_PASS=password

  # ë°ì´í„°ë² ì´ìŠ¤ (MySQL)
  database:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: password
      MYSQL_DATABASE: myapp
    volumes:
      - mysql-data:/var/lib/mysql

  # ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ (phpMyAdmin)
  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    ports:
      - "8080:80"
    environment:
      PMA_HOST: database
      PMA_USER: root
      PMA_PASSWORD: password
    depends_on:
      - database

volumes:
  mysql-data:
```

### ğŸ Django + PostgreSQL
```yaml
version: '3.8'

services:
  # Django ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜
  web:
    build: .
    command: python manage.py runserver 0.0.0.0:8000
    volumes:
      - .:/code
    ports:
      - "8000:8000"
    environment:
      - DEBUG=1
      - DATABASE_URL=postgres://postgres:password@db:5432/django_db
    depends_on:
      - db

  # PostgreSQL ë°ì´í„°ë² ì´ìŠ¤
  db:
    image: postgres:13
    environment:
      POSTGRES_DB: django_db
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
    volumes:
      - postgres-data:/var/lib/postgresql/data

volumes:
  postgres-data:
```

### ğŸš€ Node.js + MongoDB
```yaml
version: '3.8'

services:
  # Node.js ì• í”Œë¦¬ì¼€ì´ì…˜
  app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=development
      - MONGODB_URI=mongodb://mongo:27017/myapp
    volumes:
      - .:/app
      - /app/node_modules
    depends_on:
      - mongo

  # MongoDB ë°ì´í„°ë² ì´ìŠ¤
  mongo:
    image: mongo:5.0
    ports:
      - "27017:27017"
    volumes:
      - mongo-data:/data/db

volumes:
  mongo-data:
```

## í™˜ê²½ ë³€ìˆ˜ì™€ ì„¤ì •

### ğŸ“ .env íŒŒì¼ ì‚¬ìš©
```bash
# .env íŒŒì¼
NODE_ENV=development
DATABASE_URL=postgres://user:pass@db:5432/myapp
API_PORT=3000
```

```yaml
# docker-compose.yml
version: '3.8'

services:
  app:
    image: my-app
    ports:
      - "${API_PORT}:3000"
    environment:
      - NODE_ENV=${NODE_ENV}
      - DATABASE_URL=${DATABASE_URL}
    # ë˜ëŠ” ì „ì²´ .env íŒŒì¼ ë¡œë“œ
    env_file:
      - .env
```

### ğŸ¯ í™˜ê²½ë³„ ì„¤ì • íŒŒì¼
```bash
# ê°œë°œ í™˜ê²½
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up

# ìš´ì˜ í™˜ê²½
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up
```

```yaml
# docker-compose.dev.yml
version: '3.8'

services:
  app:
    environment:
      - DEBUG=true
    volumes:
      - .:/app  # ê°œë°œ ì‹œ ì½”ë“œ ì‹¤ì‹œê°„ ë°˜ì˜
    ports:
      - "3000:3000"

  database:
    ports:
      - "5432:5432"  # ê°œë°œ ì‹œ DB ì§ì ‘ ì ‘ê·¼
```

## ë„¤íŠ¸ì›Œí‚¹ê³¼ ë³¼ë¥¨

### ğŸŒ ë„¤íŠ¸ì›Œí¬ ì„¤ì •
```yaml
version: '3.8'

services:
  frontend:
    image: my-frontend
    networks:
      - web-tier
    ports:
      - "80:80"
  
  backend:
    image: my-backend
    networks:
      - web-tier
      - db-tier
  
  database:
    image: postgres:13
    networks:
      - db-tier

networks:
  web-tier:
    driver: bridge
  db-tier:
    driver: bridge
    internal: true  # ì™¸ë¶€ ì ‘ê·¼ ì°¨ë‹¨
```

### ğŸ’¾ ë³¼ë¥¨ ê´€ë¦¬
```yaml
version: '3.8'

services:
  app:
    image: my-app
    volumes:
      # ëª…ëª…ëœ ë³¼ë¥¨
      - app-data:/app/data
      
      # Bind mount
      - ./src:/app/src
      
      # ì½ê¸° ì „ìš©
      - ./config:/app/config:ro

volumes:
  app-data:
    driver: local
```

## ì˜ì¡´ì„±ê³¼ í—¬ìŠ¤ì²´í¬

### ğŸ”— ì„œë¹„ìŠ¤ ì˜ì¡´ì„±
```yaml
version: '3.8'

services:
  web:
    image: nginx
    depends_on:
      - api
      - database
    ports:
      - "80:80"

  api:
    image: my-api
    depends_on:
      - database
    environment:
      - DB_HOST=database

  database:
    image: postgres:13
    environment:
      POSTGRES_PASSWORD: password
```

### ğŸ¥ í—¬ìŠ¤ì²´í¬ ì„¤ì •
```yaml
version: '3.8'

services:
  web:
    image: nginx
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  database:
    image: postgres:13
    environment:
      POSTGRES_PASSWORD: password
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 30s
      timeout: 5s
      retries: 5
```

## ë¬¸ì œ í•´ê²°

### ğŸ› ì¼ë°˜ì ì¸ ë¬¸ì œë“¤

#### 1. ì„œë¹„ìŠ¤ ì‹œì‘ ì‹¤íŒ¨
```bash
# ìì„¸í•œ ë¡œê·¸ í™•ì¸
docker-compose logs service-name

# ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
docker-compose ps

# ì»¨í…Œì´ë„ˆ ì§ì ‘ ì‹¤í–‰í•´ì„œ ë””ë²„ê¹…
docker-compose run --rm service-name bash
```

#### 2. í¬íŠ¸ ì¶©ëŒ
```bash
# ì—ëŸ¬: port is already allocated
# í•´ê²°: ë‹¤ë¥¸ í¬íŠ¸ ì‚¬ìš© ë˜ëŠ” ê¸°ì¡´ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
docker-compose down
sudo lsof -i :8080
sudo kill -9 PID
```

#### 3. ë³¼ë¥¨ ê¶Œí•œ ë¬¸ì œ
```yaml
# ì‚¬ìš©ì ID ì§€ì •
services:
  app:
    user: "1000:1000"
    volumes:
      - ./data:/app/data
```

#### 4. ë„¤íŠ¸ì›Œí¬ í†µì‹  ë¬¸ì œ
```bash
# ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸
docker network ls
docker network inspect project_default

# ì»¨í…Œì´ë„ˆ ê°„ ì—°ê²° í…ŒìŠ¤íŠ¸
docker-compose exec web ping database
```

## ëª¨ë²” ì‚¬ë¡€

### âœ… DO (í•´ì•¼ í•  ê²ƒë“¤)
```yaml
# 1. ëª…í™•í•œ ì„œë¹„ìŠ¤ ì´ë¦„ ì‚¬ìš©
services:
  web-frontend:
  api-backend:
  postgres-database:

# 2. í™˜ê²½ ë³€ìˆ˜ ì™¸ë¶€í™”
env_file:
  - .env

# 3. ì¬ì‹œì‘ ì •ì±… ì„¤ì •
restart: unless-stopped

# 4. í—¬ìŠ¤ì²´í¬ ì„¤ì •
healthcheck:
  test: ["CMD", "curl", "-f", "http://localhost/health"]

# 5. ì ì ˆí•œ ì˜ì¡´ì„± ì„¤ì •
depends_on:
  - database
```

### âŒ DON'T (í•˜ì§€ ë§ì•„ì•¼ í•  ê²ƒë“¤)
```yaml
# 1. í•˜ë“œì½”ë”©ëœ ë¹„ë°€ë²ˆí˜¸ ì‚¬ìš© ê¸ˆì§€
environment:
  - DB_PASSWORD=hardcoded-password  # âŒ

# 2. latest íƒœê·¸ ì‚¬ìš© ê¸ˆì§€ (ìš´ì˜í™˜ê²½)
image: nginx:latest  # âŒ

# 3. ë¶ˆí•„ìš”í•œ í¬íŠ¸ ë…¸ì¶œ ê¸ˆì§€
ports:
  - "5432:5432"  # DB í¬íŠ¸ë¥¼ ì™¸ë¶€ì— ë…¸ì¶œ âŒ

# 4. ë£¨íŠ¸ ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰ ê¸ˆì§€
user: root  # âŒ
```

## ìœ ìš©í•œ íŒ

### ğŸ¯ ê°œë°œ íš¨ìœ¨ì„± íŒ
```bash
# 1. ìì£¼ ì‚¬ìš©í•˜ëŠ” ëª…ë ¹ì–´ alias ì„¤ì •
alias dcup='docker-compose up -d'
alias dcdown='docker-compose down'
alias dclogs='docker-compose logs -f'
alias dcps='docker-compose ps'

# 2. íŠ¹ì • ì„œë¹„ìŠ¤ë§Œ ì¬ë¹Œë“œ
docker-compose up -d --build web

# 3. ì„¤ì • íŒŒì¼ ê²€ì¦
docker-compose config

# 4. ì„œë¹„ìŠ¤ ì¢…ì†ì„± ë¬´ì‹œí•˜ê³  ì‹¤í–‰
docker-compose up -d --no-deps web
```

### ğŸ”§ ìœ ì§€ë³´ìˆ˜ íŒ
```bash
# 1. ì •ê¸°ì ì¸ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
docker-compose pull
docker-compose up -d

# 2. ë¯¸ì‚¬ìš© ë¦¬ì†ŒìŠ¤ ì •ë¦¬
docker-compose down --remove-orphans
docker system prune -a

# 3. ì„¤ì • íŒŒì¼ ë°±ì—…
cp docker-compose.yml docker-compose.yml.backup
```

## ë‹¤ìŒ ë‹¨ê³„

### ğŸ“ í•™ìŠµ ìˆœì„œ
Docker Compose ê¸°ì´ˆë¥¼ ë§ˆìŠ¤í„°í–ˆë‹¤ë©´:
1. **[[Docker Compose ê³ ê¸‰]]** - ì‹¤ë¬´ í™˜ê²½ êµ¬ì„±ê³¼ ìµœì í™”
2. **[[Docker ì‹¤ìŠµ ê°€ì´ë“œ]]** - ì‹¤ì „ í”„ë¡œì íŠ¸ ì§„í–‰

### ğŸ’¡ ì˜¤ëŠ˜ í•´ë³¼ ì‹¤ìŠµ
```bash
# ê¸°ì´ˆ ì‹¤ìŠµ ì¶”ì²œ
1. LAMP ìŠ¤íƒìœ¼ë¡œ ê°„ë‹¨í•œ ì›¹ì‚¬ì´íŠ¸ ë§Œë“¤ê¸°
2. Django + PostgreSQL ê°œë°œ í™˜ê²½ êµ¬ì„±
3. Node.js + MongoDB API ì„œë²„ êµ¬ì¶•
4. í™˜ê²½ ë³€ìˆ˜ë¡œ ê°œë°œ/ìš´ì˜ í™˜ê²½ ë¶„ë¦¬í•´ë³´ê¸°
```

### ğŸš€ ë‹¤ìŒì— ë°°ìš¸ ë‚´ìš©
- ğŸ”¥ **ë³µì¡í•œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜**
- ğŸ“Š **ëª¨ë‹ˆí„°ë§ê³¼ ë¡œê¹… ì‹œìŠ¤í…œ êµ¬ì¶•**
- ğŸš€ **CI/CD íŒŒì´í”„ë¼ì¸ ì—°ë™**
- âš¡ **ì„±ëŠ¥ ìµœì í™”ì™€ ìŠ¤ì¼€ì¼ë§**

Docker Compose ê¸°ì´ˆë¥¼ ìµí˜”ë‹¤ë©´ [[Docker Compose ê³ ê¸‰]]ì—ì„œ ì‹¤ë¬´ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê³ ê¸‰ ê¸°ëŠ¥ë“¤ì„ ë°°ì›Œë³´ì„¸ìš”!

**Happy Composing! ğŸ¼**

#Docker #DockerCompose #ê¸°ì´ˆ #ë‹¤ì¤‘ì»¨í…Œì´ë„ˆ #YAML
